<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>02_G1785</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="02_G1785_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_G1785_files/libs/quarto-html/quarto.js"></script>
<script src="02_G1785_files/libs/quarto-html/popper.min.js"></script>
<script src="02_G1785_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_G1785_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_G1785_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_G1785_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_G1785_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_G1785_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_G1785_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">02_G1785</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="authorship-of-the-introductory-texts-in-galerie-1785" class="level1">
<h1>Authorship of the introductory texts in Galerie 1785</h1>
<section id="load-packages" class="level3">
<h3 class="anchored" data-anchor-id="load-packages">load packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stylo)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seetrees)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quick-book-based-exploration" class="level2">
<h2 class="anchored" data-anchor-id="quick-book-based-exploration">Quick book-based exploration</h2>
<section id="write-data" class="level3">
<h3 class="anchored" data-anchor-id="write-data">write data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fh <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../../corpus_texts/"</span>, <span class="at">full.names =</span> T)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> fh,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">sapply</span>(path, read_file),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">str_remove_all</span>(path, <span class="st">"</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./corpus_texts//|</span><span class="sc">\\</span><span class="st">.txt"</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">path_new =</span> <span class="fu">str_remove_all</span>(path, <span class="st">"^</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(id, <span class="st">"^G1787"</span>)) <span class="co"># remove texts from 1787 volumes</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write texts for easier stylo use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(corpus)) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_file</span>(corpus<span class="sc">$</span>text[i], <span class="at">file =</span> corpus<span class="sc">$</span>path_new[i])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stylo---quick-tests" class="level3">
<h3 class="anchored" data-anchor-id="stylo---quick-tests">stylo - quick tests</h3>
<section id="mfw" class="level4">
<h4 class="anchored" data-anchor-id="mfw">200 mfw</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>test_00 <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gui =</span> F,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.dir =</span> <span class="st">"corpus_texts/"</span>, <span class="co"># given that texts are already created</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.lang =</span> <span class="st">"Other"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.min =</span> <span class="dv">200</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.max =</span> <span class="dv">200</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using current directory...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Performing no sampling (using entire text as sample)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>slicing input text into tokens...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
turning words into features, e.g. char n-grams (if applicable)...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Total nr. of samples in the corpus: 33</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The corpus consists of 708978 tokens</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>processing  33  text samples</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>...
combining frequencies into a table...


culling @ 0 available features (words) 5000
Calculating z-scores... 

MFW used: 
200 
Processing metadata...


Assigning plot colors according to file names...

 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view_tree</span>(test_00, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">label_size =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bootstrap" class="level4">
<h4 class="anchored" data-anchor-id="bootstrap">bootstrap</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>bct <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gui =</span> F,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.min =</span> <span class="dv">100</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.max =</span> <span class="dv">500</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.incr =</span> <span class="dv">1</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysis.type =</span> <span class="st">"BCT"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">consensus.strength =</span> <span class="fl">0.5</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.dir =</span> <span class="st">"corpus_texts/"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.lang =</span> <span class="st">"Other"</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(bct, test_00, corpus, fh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(bct, test_00, corpus, fh): object 'corpus' not found</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(bct, test_00, corpus, fh): object 'fh' not found</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="authors-samples-sampling" class="level1">
<h1>Authors’ samples &amp; sampling</h1>
<section id="create-data" class="level2">
<h2 class="anchored" data-anchor-id="create-data">create data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fh_authors <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../../corpus_authors/"</span>, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">full.names =</span> T)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>fh_q <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../../corpus_texts/"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pattern =</span> <span class="st">"^G1785"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full.names =</span> T)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>fh <span class="ot">&lt;-</span> <span class="fu">c</span>(fh_authors, fh_q)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(fh_authors, fh_q)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> fh,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">sapply</span>(path, read_file)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">author =</span> <span class="fu">str_remove_all</span>(path, <span class="st">"</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./.*?//|</span><span class="sc">\\</span><span class="st">.txt"</span>),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">path_new =</span> <span class="fu">str_remove_all</span>(path, <span class="st">"</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">./.*?//"</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">path_new =</span> <span class="fu">paste0</span>(<span class="st">"corpus_authors//"</span>, path_new)) </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(corpus)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(corpus<span class="sc">$</span>author)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(corpus<span class="sc">$</span>path_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="save" class="level3">
<h3 class="anchored" data-anchor-id="save">save</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(corpus)) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_file</span>(corpus<span class="sc">$</span>text[i], <span class="at">file =</span> corpus<span class="sc">$</span>path_new[i])</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">load data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fh <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"corpus_authors/"</span>,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">full.names =</span> T)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> fh,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">sapply</span>(path, read_file)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">author =</span> <span class="fu">str_remove_all</span>(path, <span class="st">"corpus_authors//|</span><span class="sc">\\</span><span class="st">.txt"</span>)) </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16
Columns: 3
$ path   &lt;chr&gt; "corpus_authors//Bergasse.txt", "corpus_authors//Brissot.txt", …
$ text   &lt;chr&gt; "pauvres ils apprendra pas les au enseignement ment action pui …
$ author &lt;chr&gt; "Bergasse", "Brissot", "Condorcet", "D'Alembert", "Delisle-de-S…</code></pre>
</div>
</div>
<section id="corpus_size" class="level3">
<h3 class="anchored" data-anchor-id="corpus_size">corpus_size</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>corpus <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(author, <span class="at">sort =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   author                                        n
   &lt;chr&gt;                                     &lt;int&gt;
 1 Delisle-de-Sales                          45000
 2 D'Alembert                                39512
 3 Marmontel                                 37610
 4 Condorcet                                 29779
 5 Garat                                     25168
 6 Sieyes                                    24810
 7 Bergasse                                  24034
 8 La-Harpe                                  22623
 9 Brissot                                   19745
10 G1785_1_Tableau général de la littérature 13404
11 Villar                                    12400
12 Gouges                                    11423
13 G1785_3_Troisième tableau                  8465
14 G1785_0_Préface                            7560
15 G1785_2_Second tableau                     6350
16 G1785_4_Discours préliminaire              3670</code></pre>
</div>
</div>
</section>
</section>
<section id="exploration" class="level2">
<h2 class="anchored" data-anchor-id="exploration">Exploration</h2>
<section id="mfw-200" class="level3">
<h3 class="anchored" data-anchor-id="mfw-200">mfw 200</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>test_200mfw <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gui =</span> F,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.min =</span> <span class="dv">200</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.max =</span> <span class="dv">200</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.dir =</span> <span class="st">"corpus_authors/"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.lang =</span> <span class="st">"Other"</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using current directory...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Performing no sampling (using entire text as sample)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>slicing input text into tokens...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
turning words into features, e.g. char n-grams (if applicable)...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Total nr. of samples in the corpus: 16</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The corpus consists of 331869 tokens</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>processing  16  text samples</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>.
combining frequencies into a table...


culling @ 0 available features (words) 5000
Calculating z-scores... 

MFW used: 
200 
Processing metadata...


Assigning plot colors according to file names...

 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bootstrap-all" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-all">bootstrap, all</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>bct_all <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gui =</span> F,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.min =</span> <span class="dv">100</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.max =</span> <span class="dv">500</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.incr =</span> <span class="dv">1</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysis.type =</span> <span class="st">"BCT"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.dir =</span> <span class="st">"corpus_authors/"</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.lang =</span> <span class="st">"Other"</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="sampling" class="level2">
<h2 class="anchored" data-anchor-id="sampling">Sampling</h2>
<section id="function" class="level3">
<h3 class="anchored" data-anchor-id="function">function</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>sample_independent <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                               sample_size,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                               n_samples,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">text_var =</span> <span class="st">"word"</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">folder =</span> <span class="st">"corpus_samples_dump/"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">overwrite =</span> T) {</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 0 create/rewrite folder</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(folder)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(overwrite) {</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list.files</span>(<span class="st">"corpus_samples_dump/"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I tokenization &amp; ceiling</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  corpus_tokenized <span class="ot">&lt;-</span> corpus <span class="sc">%&gt;%</span> </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(author) <span class="sc">%&gt;%</span> </span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reshuffle words inside each author</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do</span>(<span class="fu">sample_n</span>(., <span class="at">size =</span> <span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">ceiling</span>(<span class="fu">row_number</span>()<span class="sc">/</span>sample_size)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(sample_id, <span class="fu">c</span>(author, sample), <span class="at">remove =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sample <span class="sc">!=</span> <span class="fu">max</span>(sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(sample_id, author, word, sample)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># II set seeds</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  seed_samples <span class="ot">&lt;-</span> corpus_tokenized <span class="sc">%&gt;%</span> </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(sample_id, author) <span class="sc">%&gt;%</span> </span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(author) <span class="sc">%&gt;%</span> </span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample_n</span>(n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(sample_id)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">### III create table with 1 row = 1 sample</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    true_samples <span class="ot">&lt;-</span> corpus_tokenized <span class="sc">%&gt;%</span> </span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(sample_id <span class="sc">%in%</span> seed_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(sample_id) <span class="sc">%&gt;%</span> </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="sc">!!</span><span class="fu">sym</span>(text_var), <span class="at">collapse =</span> <span class="st">" "</span>))</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">### IV write samples in the folder</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(true_samples)) {</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_file</span>(<span class="at">file =</span> <span class="fu">paste0</span>(folder, true_samples<span class="sc">$</span>sample_id[i], <span class="st">".txt"</span>),</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>                 true_samples<span class="sc">$</span>text[i])</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-samples" class="level3">
<h3 class="anchored" data-anchor-id="test-samples">test samples</h3>
<section id="mfw-1" class="level4">
<h4 class="anchored" data-anchor-id="mfw-1">100 mfw</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_independent</span>(<span class="at">corpus =</span> corpus,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sample_size =</span> <span class="dv">1800</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_samples =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dir.create(folder): 'corpus_samples_dump' already exists</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>test_samples_0 <span class="ot">&lt;-</span> <span class="fu">stylo</span>(<span class="at">gui=</span>F,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.min=</span><span class="dv">100</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.max=</span><span class="dv">100</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">#number.of.samples=2,</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.lang=</span><span class="st">"Other"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.dir=</span><span class="st">"corpus_samples_dump/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view_tree</span>(test_samples_0, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">label_size =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>test_samples_0<span class="sc">$</span>features.actually.used</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------
features (e.g. frequent words) actually analyzed 
------------------------------------------------

  [1]  de        la        les       le        des       que       il        
  [8]  en        qui       dans      qu        un        est       on        
 [15]  ne        du        une       pour      plus      ce        et        
 [22]  par       se        pas       nous      au        sur       cette     
 [29]  ils       je        même     leur      son       mais      avec      
 [36]  être     sont      lui       aux       ces       ses       si        
 [43]  ou        elle      sa        tous      vous      comme     ont       
 [50]  tout      étoit    leurs     sans      dont      peut      fait      
 [57]  langue    bien      faire     encore    hommes    point     où       
 [64]  temps     avoir     homme     me        été     avoit     toutes    
 [71]  nos       ceux      moins     peuple    autres    doit      autre     
 [78]  toujours  sous      latin     deux      lettres   peu       dit       
 [85]  celle     grand     après    alors     fut       cet       donc      
 [92]  nature    toute     ni        quand     contre    mon       nation    
 [99]  notre     tant      

(total number of elements:  100)</code></pre>
</div>
</div>
</section>
<section id="mfw-2" class="level4">
<h4 class="anchored" data-anchor-id="mfw-2">200 mfw</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_independent</span>(<span class="at">corpus =</span> corpus,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sample_size =</span> <span class="dv">1800</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_samples =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dir.create(folder): 'corpus_samples_dump' already exists</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>test_samples_1 <span class="ot">&lt;-</span> <span class="fu">stylo</span>(<span class="at">gui=</span>F,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.min=</span><span class="dv">200</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.max=</span><span class="dv">200</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">#number.of.samples=2,</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.lang=</span><span class="st">"Other"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.dir=</span><span class="st">"corpus_samples_dump/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view_tree</span>(test_samples_1, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">label_size =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>test_samples_1<span class="sc">$</span>features.actually.used</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------
features (e.g. frequent words) actually analyzed 
------------------------------------------------

  [1]  de         la         les        le         des        que        
  [7]  il         qui        en         qu         dans       un         
 [13]  est        on         pour       ne         une        du         
 [19]  plus       ce         par        et         pas        se         
 [25]  au         ils        cette      mais       nous       sur        
 [31]  ces        je         leur       ses        si         son        
 [37]  sont       même      lui        avec       tout       tous       
 [43]  vous       ont        être      ou         aux        elle       
 [49]  sa         étoit     comme      sans       leurs      langue     
 [55]  dont       peut       fait       bien       faire      où        
 [61]  encore     point      avoit      hommes     avoir      toutes     
 [67]  homme      temps      autres     nos        ceux       moins      
 [73]  me         doit       été      peu        peuple     toujours   
 [79]  sous       autre      celle      faut       cet        parce      
 [85]  après     ai         dire       lettres    deux       latin      
 [91]  donc       grand      contre     depuis     ni         notre      
 [97]  trop       entre      non        tant       société  elles      
[103]  grande     liberté   fut        france     jamais     nation     
[109]  nature     droit      peuples    quelques   étoient   mon        
[115]  toute      premier    quand      soit       dit        enfin      
[121]  vie        eux        loi        rien       ii         loix       
[127]  mêmes     voir       alors      celui      intérêt  langage    
[133]  opinion    françois  gaules     nombre     voit       donner     
[139]  gaulois    long       public     état      fois       là        
[145]  génie     mots       ordre      sera       avoient    eu         
[151]  ma         manière   partie     sciences   gens       jour       
[157]  très      vers       car        pouvoir    ufage      anciens    
[163]  chez       auroit     aussi      droits     louis      monde      
[169]  principes  roi        fiècle    force      moi        quelque    
[175]  rendre     seroit     vos        cela       esprit     gloire     
[181]  grands     mesmer     nom        saint      votre      arts       
[187]  aujourd    autant     mes        pays       peuvent    tems       
[193]  ainfi      auteur     effet      fit        hui        ici        
[199]  livres     quel       

(total number of elements:  200)</code></pre>
</div>
</div>
</section>
</section>
<section id="bct-samples" class="level3">
<h3 class="anchored" data-anchor-id="bct-samples">bct samples</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bct_samples <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">gui=</span>F,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.min=</span><span class="dv">100</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.max=</span><span class="dv">200</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.incr =</span> <span class="dv">1</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">analysis.type =</span> <span class="st">"BCT"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">consensus.strength =</span> <span class="fl">0.5</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.dir=</span><span class="st">"corpus_samples_dump/"</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.lang=</span><span class="st">"Other"</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="larger-samples" class="level2">
<h2 class="anchored" data-anchor-id="larger-samples">Larger samples</h2>
<p>Remove the smallest text G1785_4</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>corpus <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(author, <span class="at">sort =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   author                                        n
   &lt;chr&gt;                                     &lt;int&gt;
 1 Delisle-de-Sales                          45000
 2 D'Alembert                                39512
 3 Marmontel                                 37610
 4 Condorcet                                 29779
 5 Garat                                     25168
 6 Sieyes                                    24810
 7 Bergasse                                  24034
 8 La-Harpe                                  22623
 9 Brissot                                   19745
10 G1785_1_Tableau général de la littérature 13404
11 Villar                                    12400
12 Gouges                                    11423
13 G1785_3_Troisième tableau                  8465
14 G1785_0_Préface                            7560
15 G1785_2_Second tableau                     6350
16 G1785_4_Discours préliminaire              3670</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>corpus_l <span class="ot">&lt;-</span> corpus <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(author <span class="sc">!=</span> <span class="st">"G1785_4_Discours préliminaire"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="test-samples-1" class="level3">
<h3 class="anchored" data-anchor-id="test-samples-1">test samples</h3>
<section id="samples-2k-words" class="level4">
<h4 class="anchored" data-anchor-id="samples-2k-words">3 samples, 2k words</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_independent</span>(<span class="at">corpus =</span> corpus_l,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sample_size =</span> <span class="dv">3000</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_samples =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dir.create(folder): 'corpus_samples_dump' already exists</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>test_samples_2 <span class="ot">&lt;-</span> <span class="fu">stylo</span>(<span class="at">gui=</span>F,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.min=</span><span class="dv">200</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.max=</span><span class="dv">200</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">#number.of.samples=2,</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.lang=</span><span class="st">"Other"</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.dir=</span><span class="st">"corpus_samples_dump/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>using current directory...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Performing no sampling (using entire text as sample)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>slicing input text into tokens...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
turning words into features, e.g. char n-grams (if applicable)...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Total nr. of samples in the corpus: 30</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The corpus consists of 90072 tokens</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>processing  30  text samples</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>...
combining frequencies into a table...


culling @ 0 available features (words) 5000
Calculating z-scores... 

MFW used: 
200 
Processing metadata...


Assigning plot colors according to file names...

 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view_tree</span>(test_samples_2, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">label_size =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>test_samples_2<span class="sc">$</span>features.actually.used</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------
features (e.g. frequent words) actually analyzed 
------------------------------------------------

  [1]  de         la         les        le         des        que        
  [7]  il         qui        en         qu         dans       un         
 [13]  est        on         pour       ne         du         une        
 [19]  ce         plus       et         par        pas        se         
 [25]  au         nous       cette      je         sur        mais       
 [31]  ils        ces        si         ses        son        même      
 [37]  leur       ou         sa         lui        tout       elle       
 [43]  sont       ont        aux        avec       tous       comme      
 [49]  vous       langue     étoit     dont       sans       être      
 [55]  bien       peut       leurs      fait       où        encore     
 [61]  faire      point      hommes     toutes     temps      autres     
 [67]  me         avoir      nos        avoit      ceux       été      
 [73]  moins      homme      doit       dit        deux       peu        
 [79]  sous       donc       ni         peuple     autre      latin      
 [85]  fut        toujours   elles      eux        faut       cet        
 [91]  grand      nature     toute      jamais     ai         lettres    
 [97]  là        mon        celle      quelques   françois  après     
[103]  contre     tant       entre      dire       notre      quand      
[109]  soit       roi        droit      celui      nation     non        
[115]  étoient   parce      rien       depuis     partie     alors      
[121]  ii         trop       gaulois    sera       esprit     seroit     
[127]  voir       moi        nom        société  loix       nombre     
[133]  fois       france     mêmes     pouvoir    premier    langage    
[139]  loi        vie        vos        votre      enfin      peuples    
[145]  principes  aussi      donner     grands     ma         avoient    
[151]  gens       quelque    cependant  frédéric hui        long       
[157]  mieux      pays       très      vers       état      fiècle    
[163]  ici        monde      grande     ufage      génie     voit       
[169]  louis      sciences   vérité   eu         gaules     mots       
[175]  jour       liberté   ouvrage    première  pu         aujourd    
[181]  auroit     corps      doute      force      mes        ait        
[187]  autant     beaucoup   car        manière   moment     parler     
[193]  public     rendre     arts       fit        gloire     peuvent    
[199]  sol        droits     

(total number of elements:  200)</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="remove-words" class="level1">
<h1>Remove words</h1>
<p>Filter out topic-related words</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16
Columns: 3
$ path   &lt;chr&gt; "corpus_authors//Bergasse.txt", "corpus_authors//Brissot.txt", …
$ text   &lt;chr&gt; "pauvres ils apprendra pas les au enseignement ment action pui …
$ author &lt;chr&gt; "Bergasse", "Brissot", "Condorcet", "D'Alembert", "Delisle-de-S…</code></pre>
</div>
</div>
<p>Select words based on the features above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>signal_words <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"^langue"</span>, <span class="st">"^latin"</span>, <span class="st">"^fut"</span>, <span class="st">"liberté"</span>,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^gaule"</span>, <span class="st">"^lettre"</span>, <span class="st">"^hui$"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^gaulois"</span>, <span class="st">"^language"</span>, <span class="st">"^ainfi"</span>, <span class="st">"^ainsi"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^louis$"</span>, <span class="st">"^mesmer$"</span>, <span class="st">"frédéric"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^génie"</span>, </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^loi"</span>,<span class="st">"^ancien"</span>, <span class="st">"^roi$"</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^liberté$"</span>, <span class="st">"^france$"</span>, <span class="st">"^francois"</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^je$"</span>, <span class="st">"^ma$"</span>, <span class="st">"^mon$"</span>, <span class="st">"^moi$"</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"^vous$"</span>, <span class="st">"^vos$"</span>, <span class="st">"^votre$"</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">collapse =</span> <span class="st">"|"</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write 1 text = 1 row</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>corpus_filtered <span class="ot">&lt;-</span> corpus <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">str_replace_all</span>(word, <span class="st">"^ufage$"</span>, <span class="st">"usage"</span>),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">word =</span> <span class="fu">str_replace_all</span>(word, <span class="st">"^fiècle"</span>, <span class="st">"siècle"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, signal_words))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
</div>
<section id="n-tokens-after-filter" class="level3">
<h3 class="anchored" data-anchor-id="n-tokens-after-filter">n tokens after filter</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(corpus_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 323687</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>corpus_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(author, <span class="at">sort =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   author                                        n
   &lt;chr&gt;                                     &lt;int&gt;
 1 Delisle-de-Sales                          44144
 2 D'Alembert                                39149
 3 Marmontel                                 36079
 4 Condorcet                                 29305
 5 Garat                                     24732
 6 Sieyes                                    24361
 7 Bergasse                                  23169
 8 La-Harpe                                  22181
 9 Brissot                                   19376
10 G1785_1_Tableau général de la littérature 13101
11 Villar                                    12016
12 Gouges                                    10962
13 G1785_3_Troisième tableau                  8037
14 G1785_0_Préface                            7438
15 G1785_2_Second tableau                     6010
16 G1785_4_Discours préliminaire              3627</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>corpus_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">==</span> <span class="st">"ufage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: path &lt;chr&gt;, author &lt;chr&gt;, word &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>corpus_filtered <span class="ot">&lt;-</span> corpus_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(author) <span class="sc">%&gt;%</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">paste</span>(word, <span class="at">collapse =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>word) <span class="sc">%&gt;%</span> </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(corpus_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16
Columns: 3
$ path   &lt;chr&gt; "corpus_authors//Bergasse.txt", "corpus_authors//Brissot.txt", …
$ author &lt;chr&gt; "Bergasse", "Brissot", "Condorcet", "D'Alembert", "Delisle-de-S…
$ text   &lt;chr&gt; "pauvres ils apprendra pas les au enseignement ment action pui …</code></pre>
</div>
</div>
</section>
<section id="sampling-1" class="level2">
<h2 class="anchored" data-anchor-id="sampling-1">sampling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_independent</span>(<span class="at">corpus =</span> corpus_filtered,</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sample_size =</span> <span class="dv">1800</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_samples =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dir.create(folder): 'corpus_samples_dump' already exists</code></pre>
</div>
</div>
</section>
<section id="tests" class="level2">
<h2 class="anchored" data-anchor-id="tests">tests</h2>
<section id="mfw-3" class="level3">
<h3 class="anchored" data-anchor-id="mfw-3">100 mfw</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>test_filtered_100 <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gui =</span> F,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.min =</span> <span class="dv">100</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.max =</span> <span class="dv">100</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.dir =</span> <span class="st">"corpus_samples_dump/"</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.lang =</span> <span class="st">"Other"</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>test_filtered_200 <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gui =</span> F,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.min =</span> <span class="dv">200</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfw.max =</span> <span class="dv">200</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.dir =</span> <span class="st">"corpus_samples_dump/"</span>,</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">corpus.lang =</span> <span class="st">"Other"</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view_tree</span>(test_filtered_200, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">label_size =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>test_filtered_200<span class="sc">$</span>features.actually.used</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------
features (e.g. frequent words) actually analyzed 
------------------------------------------------

  [1]  de         la         les        le         des        que        
  [7]  en         il         qui        qu         un         dans       
 [13]  est        on         ne         du         pour       plus       
 [19]  une        ce         et         par        pas        se         
 [25]  nous       au         ils        mais       cette      sur        
 [31]  leur       son        même      ces        ses        si         
 [37]  sont       tout       elle       lui        tous       ou         
 [43]  avec       sa         comme      être      ont        étoit     
 [49]  aux        leurs      sans       peut       dont       fait       
 [55]  encore     point      où        bien       faire      nos        
 [61]  hommes     homme      temps      autres     été      moins      
 [67]  ceux       avoit      doit       toutes     avoir      me         
 [73]  après     cet        peuple     sous       toujours   autre      
 [79]  deux       grand      donc       faut       notre      toute      
 [85]  françois  nation     celle      ni         ai         depuis     
 [91]  dire       eux        là        peu        alors      rien       
 [97]  trop       siècle    tant       celui      elles      étoient   
[103]  nature     quelques   ii         jamais     parce      quelque    
[109]  société  dit        nombre     contre     grande     soit       
[115]  entre      quand      sciences   sera       voir       vie        
[121]  mêmes     seroit     avoient    esprit     sol        vers       
[127]  donner     enfin      premier    fois       monde      nom        
[133]  droit      peuples    principes  jour       mieux      mots       
[139]  non        usage      arts       pouvoir    très      amour      
[145]  car        langage    parler     partie     vérité   beaucoup   
[151]  état      gens       pu         public     saint      aucun      
[157]  avant      force      grands     ici        mes        trois      
[163]  autant     doute      eu         moment     seul       tems       
[169]  donné     long       pays       rendre     bonheur    citoyens   
[175]  fit        ouvrages   publique   siècles   aussi      avons      
[181]  cela       celtique   intérêt  livres     mi         ouvrage    
[187]  aujourd    auroit     cependant  doivent    droits     furent     
[193]  mal        premiers   veut       voit       ans        genre      
[199]  goût      jufqu      

(total number of elements:  200)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>test_filtered_bct <span class="ot">&lt;-</span> <span class="fu">stylo</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">gui=</span>F,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.min=</span><span class="dv">50</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.max=</span><span class="dv">200</span>,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mfw.incr =</span> <span class="dv">1</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">analyzed.features =</span> <span class="st">"w"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ngram.size =</span> <span class="dv">1</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">analysis.type =</span> <span class="st">"BCT"</span>,</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">consensus.strength =</span> <span class="fl">0.5</span>,</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">distance.measure =</span> <span class="st">"wurzburg"</span>,</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.dir=</span><span class="st">"corpus_samples_dump/"</span>,</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">corpus.lang=</span><span class="st">"Other"</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="distribution-of-distances" class="level1">
<h1>Distribution of distances</h1>
<p>Replication from navalny.R https://github.com/perechen/navalny_R/blob/main/stylometry_navalny.md</p>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">functions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="do">### function to process distance table</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>process_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(stylo_res) {</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> stylo_res <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>d_long <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source=</span><span class="fu">colnames</span>(dt)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dt),<span class="at">names_to=</span><span class="st">"target"</span>,<span class="at">values_to =</span><span class="st">"distance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source=</span><span class="fu">str_remove</span>(source, <span class="st">"_[0-9]*$"</span>),</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">target=</span><span class="fu">str_remove</span>(target, <span class="st">"_[0-9]*$"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distance <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(d_long)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="do">## function to plot distance distributions </span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>plot_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(distance,<span class="at">fill=</span>mean)) <span class="sc">+</span> </span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span>mean)) <span class="sc">+</span> </span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(source <span class="sc">~</span> target,<span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(<span class="at">high=</span>lannister[<span class="dv">1</span>],</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mid=</span>lannister[<span class="dv">3</span>],</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low=</span>lannister[<span class="dv">5</span>],</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint=</span><span class="fl">1.05</span>)</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sampling-2" class="level2">
<h2 class="anchored" data-anchor-id="sampling-2">sampling</h2>
<section id="function-1" class="level3">
<h3 class="anchored" data-anchor-id="function-1">function</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>sample_independent_opt <span class="ot">&lt;-</span> <span class="cf">function</span>(tokenized_df,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                                   n_samples,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                                   sample_size,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">text_var=</span><span class="st">"word"</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">folder=</span><span class="st">"corpus_sampled_opt/"</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">overwrite=</span>T) {</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(folder)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(overwrite) {</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(folder, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    shuff <span class="ot">&lt;-</span> tokenized_df <span class="sc">%&gt;%</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(author) <span class="sc">%&gt;%</span> </span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample_n</span>(n_samples<span class="sc">*</span>sample_size) <span class="sc">%&gt;%</span> </span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">sample=</span><span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_samples, <span class="at">each=</span>sample_size))) <span class="sc">%&gt;%</span> </span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unite</span>(sample_id,<span class="fu">c</span>(author,sample),<span class="at">remove =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(sample_id) <span class="sc">%&gt;%</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">text=</span><span class="fu">paste</span>(<span class="sc">!!</span><span class="fu">sym</span>(text_var), <span class="at">collapse=</span><span class="st">" "</span>))</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(shuff)) {</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_file</span>(<span class="at">file=</span><span class="fu">paste0</span>(folder, shuff<span class="sc">$</span>sample_id[i],<span class="st">".txt"</span>), shuff<span class="sc">$</span>text[i])</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16
Columns: 3
$ path   &lt;chr&gt; "corpus_authors//Bergasse.txt", "corpus_authors//Brissot.txt", …
$ text   &lt;chr&gt; "pauvres ils apprendra pas les au enseignement ment action pui …
$ author &lt;chr&gt; "Bergasse", "Brissot", "Condorcet", "D'Alembert", "Delisle-de-S…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>corpus <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(author, <span class="st">"G1785"</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(author) <span class="sc">%&gt;%</span> unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "G1785_0_Préface"                          
[2] "G1785_1_Tableau général de la littérature"
[3] "G1785_2_Second tableau"                   
[4] "G1785_3_Troisième tableau"                
[5] "G1785_4_Discours préliminaire"            </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only Preface &amp; Discours prelim text in question</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>removed_texts <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"G1785_1"</span>, <span class="st">"G1785_2"</span>, <span class="st">"G1785_3"</span>), <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>corpus_t <span class="ot">&lt;-</span> corpus <span class="sc">%&gt;%</span> </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(author, removed_texts)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">"words"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Outer names are only allowed for unnamed scalar atomic inputs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(corpus_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  path                         author   word     
  &lt;chr&gt;                        &lt;chr&gt;    &lt;chr&gt;    
1 corpus_authors//Bergasse.txt Bergasse pauvres  
2 corpus_authors//Bergasse.txt Bergasse ils      
3 corpus_authors//Bergasse.txt Bergasse apprendra
4 corpus_authors//Bergasse.txt Bergasse pas      
5 corpus_authors//Bergasse.txt Bergasse les      
6 corpus_authors//Bergasse.txt Bergasse au       </code></pre>
</div>
</div>
</section>
</section>
<section id="dist-iterations" class="level2">
<h2 class="anchored" data-anchor-id="dist-iterations">dist iterations</h2>
<p>Settings</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>iters <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>min_features <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>max_features <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>d_res_w <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">length =</span> iters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iters) {</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  mfw <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(min_features,max_features, <span class="at">by=</span><span class="dv">10</span>),<span class="dv">1</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_independent_opt</span>(corpus_t,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sample_size=</span><span class="dv">1800</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">text_var =</span> <span class="st">"word"</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_samples =</span> <span class="dv">2</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  tokenised_texts <span class="ot">&lt;-</span> <span class="fu">load.corpus.and.parse</span>(<span class="at">files =</span> <span class="fu">list.files</span>(</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">"corpus_sampled_opt/"</span>, <span class="at">full.names =</span> T)</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> <span class="fu">make.frequency.list</span>(tokenised_texts, <span class="at">head =</span> <span class="dv">2000</span>)</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">make.table.of.frequencies</span>(tokenised_texts, </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>                                  features,</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">relative =</span> <span class="cn">TRUE</span>)[,<span class="dv">1</span><span class="sc">:</span>mfw]</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>  s_words <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">colnames</span>(data), signal_words)</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data[, <span class="sc">!</span>s_words]</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(data) <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(<span class="fu">rownames</span>(data), <span class="st">"^.*?//"</span>)</span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">dist.wurzburg</span>(data) <span class="sc">%&gt;%</span> <span class="fu">as.dist</span>(<span class="at">upper =</span> T, <span class="at">diag =</span> T)</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>  d_long <span class="ot">&lt;-</span> <span class="fu">process_distances</span>(dt)</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>  d_res_w[[i]] <span class="ot">&lt;-</span> d_long</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(d_res_w,<span class="at">file=</span><span class="st">"d_res_w.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>lannister <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#5C0000"</span>, <span class="st">"#890000"</span>, <span class="st">"#C50000"</span>, <span class="st">"#FB7E00"</span>, <span class="st">"#FFA700"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>d_df <span class="ot">&lt;-</span> d_res_w <span class="sc">%&gt;%</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, target) <span class="sc">%&gt;%</span> </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(distance)) </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   source, target [4]
  source   target     distance  mean
  &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;
1 Bergasse Bergasse      0.661 0.668
2 Bergasse Brissot       1.07  1.06 
3 Bergasse Brissot       1.01  1.06 
4 Bergasse Condorcet     1.05  1.05 
5 Bergasse Condorcet     1.02  1.05 
6 Bergasse D'Alembert    1.09  1.05 </code></pre>
</div>
</div>
<p>Select mean pointer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_df<span class="sc">$</span>target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bergasse"                      "Brissot"                      
 [3] "Condorcet"                     "D'Alembert"                   
 [5] "Delisle-de-Sales"              "G1785_0_Préface"              
 [7] "G1785_4_Discours préliminaire" "Garat"                        
 [9] "Gouges"                        "La-Harpe"                     
[11] "Marmontel"                     "Sieyes"                       
[13] "Villar"                       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">unique</span>(d_df<span class="sc">$</span>target)[<span class="dv">6</span>]</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">unique</span>(d_df<span class="sc">$</span>target)[<span class="dv">7</span>]</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>selected_mean_x <span class="ot">&lt;-</span> d_df <span class="sc">%&gt;%</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(source <span class="sc">==</span> x <span class="sc">&amp;</span> target <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(mean) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>selected_mean_y <span class="ot">&lt;-</span> d_df <span class="sc">%&gt;%</span> </span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(source <span class="sc">==</span> y <span class="sc">&amp;</span> target <span class="sc">==</span> y) <span class="sc">%&gt;%</span> </span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(mean) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>d_df <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_distances</span>() <span class="sc">+</span> </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data=</span>. <span class="sc">%&gt;%</span> <span class="fu">filter</span>(target<span class="sc">==</span>x), </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept=</span>selected_mean_x), </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">"green"</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data=</span>. <span class="sc">%&gt;%</span> <span class="fu">filter</span>(target<span class="sc">==</span>y), </span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept=</span>selected_mean_y), </span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">"blue"</span>,</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02_G1785_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>